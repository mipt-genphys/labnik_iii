%%% rules for differen toolsets

\RequirePackage{ifpdf,ifxetex,ifluatex} 

\ifluatex
	%%% Language setting for (xe|lua)latex %%%
	\usepackage{luatextra} %грузит fontspec  и luacode
	\usepackage{polyglossia}  
	\setdefaultlanguage{russian} 
%	\setotherlanguage{english}
	\defaultfontfeatures{Renderer=Basic, Ligatures=TeX} %лигатуры работают в basic режиме
	\setmainfont{Times New Roman}
	\setsansfont{Times New Roman}
	\setmonofont{Times New Roman}
\else
	%	\RequirePDFTeX % Tests for PDFTEX use and throws an error if a different engine is being used.
	
	%%% For proper copypasting of text from pdf %%%
	\usepackage{cmap} % Better search and copypasting of cyrillic text from pdf-file. Can cause errors if used together with pdfx package.
	\defaulthyphenchar=127 % Better hyphenation for copypasting. Must be set just before fontenc.
	
	%%% Language setting for pdflatex %%%
	\usepackage[T2A]{fontenc}
	\usepackage[utf8]{inputenc}
	\usepackage[russian]{babel}
	\RequirePackage{soulutf8}
\fi


\RequirePackage{amsmath}  % дополнительные возможности математики AMS
\RequirePackage{amssymb}  % дополнительные символы AMS
\RequirePackage{mathrsfs} % для значка ЭДС

\RequirePackage{graphicx} % вставка графики
\RequirePackage{wrapfig}  % обтекание объектов
\RequirePackage{psfrag}   % вставка надписей
\RequirePackage{color}    % цветной текст

\RequirePackage{array}     % дополнительные стили для таблиц
\RequirePackage{booktabs}
\RequirePackage{longtable} % таблицы на несколько страниц
%\RequirePackage{ifthen}    % ветвление
%\RequirePackage{calc}      % вычисления

\RequirePackage{todonotes} % for revision

\graphicspath{{./pic/}}

\def\semester{3}

\newcounter{lab}

\newcommand{\lab}[2][\semester.\thelab]{
	\refstepcounter{lab}
	\section*{Работа #1. #2}
}

\newenvironment{lab:aim}{
	\noindent\textbf{Цель работы: }
	\begin{small}
}{
	\end{small}
	\\
}

\newenvironment{lab:equipment}{
	\noindent\textbf{В работе используются: }
	\begin{small}
}{
	\end{small}
	\\
}

% Добавить новую секцию без нумерации
\newcommand{\labsection}[1]{
	\subsection*{#1}
}

% Задание
\newenvironment{lab:task}{
	\subsection*{ЗАДАНИЕ}
}{}

% Контрольные вопросы
\newenvironment{lab:questions}{
	\subsection*{Контрольные вопросы}
	\begin{enumerate}
}{
	\end{enumerate}
}

\newenvironment{lab:literature}{
	\subsection*{Литература}
	\begin{enumerate}
}{
	\end{enumerate}
}

% Experiment setup block
\def\experiment{\subsection*{Экспериментальная установка} }

% Warning block
\newcommand{\warning}[1]{
	\noindent\fbox{
		\parbox{0.95\textwidth}{
			\textbf{Внимание:} #1
		}
	}%
}

% Important text
\newcommand{\important}[1]{
	\textbf{#1}
}

%%% Нумерация
% Вставить номер уравнения внутри главы или работы
% по умолчанию используется <номер главы>.<номер уравнения>
\newcommand{\eqmark}[1][\theequation]{\label{eq:\thechapter.#1}}
% Ссылка на уравнение
% == \ref{eq:#1}
\renewcommand{\eqref}[1]{({\ref{eq:\thechapter.#1}})}

% Вставить номер рисунка внутри главы или работы
% по умолчанию используется <номер главы>.<номер уравнения>
\newcommand{\figmark}[1][\thefigure]{\label{fig:\thechapter.#1}}
% Ссылка на рисунок
% == \ref{eq:#1}
\newcommand{\figref}[1]{\ref{fig:\thechapter.#1}}

% Вставить номер рисунка внутри главы или работы
% по умолчанию используется <номер главы>.<номер уравнения>
\newcommand{\tabmark}[1][\thetable]{\label{tab:\thechapter.#1}}
% Ссылка на рисунок
% == \ref{eq:#1}
\newcommand{\tabref}[1]{\ref{tab:\thechapter.#1}}

%\newcommand{\labeq}[2][]{}



%%% Математические штукчки

\def\Re{\mathop{\mathrm{Re}}}% действительная часть
\def\Im{\mathop{\mathrm{Im}}}% мнимая часть
\def\Rot{\mathop{\mathrm{rot}}}% ротор
\def\Div{\mathop{\mathrm{div}}}% дивергенция
\def\Grad{\mathop{\mathrm{grad}}}% градиент

\newcommand{\average}[1]{\left< #1 \right>}